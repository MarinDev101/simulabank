<div class="relative flex flex-col gap-4 sm:gap-5 w-full h-full bg-white rounded-2xl p-5 sm:p-8 md:p-10 lg:p-12 shadow-xl border border-[#e8f4fc] overflow-hidden">
  <!-- Decoraciones de fondo -->
  <div class="absolute top-0 right-0 w-24 h-24 sm:w-32 sm:h-32 bg-linear-to-bl from-[#1788EF]/10 to-transparent rounded-bl-full"></div>
  <div class="absolute bottom-0 left-0 w-20 h-20 sm:w-28 sm:h-28 bg-linear-to-tr from-[#00A448]/10 to-transparent rounded-tr-full"></div>

  <!-- Header del paso -->
  <div class="relative z-10 flex items-center gap-3">
    <span class="flex h-8 w-8 sm:h-9 sm:w-9 items-center justify-center rounded-full bg-linear-to-br from-[#00A448] to-[#007a34] text-sm sm:text-base font-bold text-white shadow-md">3</span>
    <div>
      <p class="text-base sm:text-lg font-semibold text-gray-800">Personalizar Perfil</p>
    </div>
  </div>

  <!-- Descripción -->
  <div class="relative z-10 text-center sm:text-left">
    <p class="text-sm sm:text-base text-gray-600 leading-relaxed">
      ¡Ya casi terminamos! Completa tu perfil para mejorar tu experiencia.
      <span class="text-xs sm:text-sm text-gray-500 block sm:inline mt-1 sm:mt-0">Este paso es opcional y podrás hacerlo más adelante.</span>
    </p>
  </div>

  <form class="relative z-10 flex flex-col gap-6 sm:gap-8">
    <!-- Foto de perfil -->
    <article class="bg-gray-50 rounded-xl p-4 sm:p-6">
      <p class="text-sm sm:text-base font-medium text-gray-700 mb-4 flex items-center gap-2">
        <span class="icon-[heroicons-outline--camera] text-lg sm:text-xl text-[#034D82]"></span>
        Personaliza tu foto de perfil
      </p>
      <div class="flex flex-col items-center gap-4">
        <div class="avatar">
          <div class="w-20 sm:w-24 md:w-28 rounded-full ring-2 ring-[#034D82]/30 ring-offset-2 ring-offset-white shadow-lg">
            <img [src]="fotoPerfil || '/images/ilustraciones/perfil_default.png'" alt="Foto de perfil" />
          </div>
        </div>
        <input
          type="file"
          #fileInput
          accept="image/jpeg,image/png"
          (change)="onFotoSeleccionada($event)"
          class="hidden"
        />
        <div class="flex gap-2">
          <button
            type="button"
            (click)="fileInput.click()"
            class="btn btn-sm sm:btn-md border-2 border-[#034D82]/60 bg-transparent text-[#034D82] font-medium rounded-xl
            hover:bg-[#034D82]/10 hover:border-[#034D82] transition-all duration-200"
          >
            <span class="icon-[subway--brush] text-base sm:text-lg"></span>
            <span class="text-xs sm:text-sm">{{ fotoPerfil ? 'Cambiar Foto' : 'Añadir Foto' }}</span>
          </button>
          @if (fotoPerfil) {
            <button
              type="button"
              (click)="limpiarFoto()"
              class="btn btn-sm sm:btn-md border-2 border-red-400 bg-transparent text-red-500 font-medium rounded-xl
              hover:bg-red-50 hover:border-red-500 transition-all duration-200"
            >
              <span class="icon-[heroicons-outline--trash] text-base sm:text-lg"></span>
              <span class="text-xs sm:text-sm">Quitar</span>
            </button>
          }
        </div>
        <p class="text-xs text-gray-500 mt-2">Solo JPEG/PNG — máx. 2 MB</p>
      </div>
    </article>

    <!-- Fecha de nacimiento -->
    <article class="bg-gray-50 rounded-xl p-4 sm:p-6">
      <p class="text-sm sm:text-base font-medium text-gray-700 mb-4 flex items-center gap-2">
        <span class="icon-[heroicons-outline--calendar] text-lg sm:text-xl text-[#034D82]"></span>
        Fecha de nacimiento
      </p>
      <div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 md:gap-5">
        <!-- Día -->
        <div class="flex flex-col flex-1 sm:flex-initial">
          <label for="dia" class="text-xs sm:text-sm text-gray-600 mb-1 sm:mb-1.5">Día</label>
          <select id="dia" name="dia" [(ngModel)]="fechaNacimiento.dia"
            (change)="marcarFechaTocada()"
            (blur)="marcarFechaTocada()"
            class="select select-sm sm:select-md w-full sm:w-20 md:w-24 border-gray-200 bg-white rounded-xl
            focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"
            [class.border-red-500]="fechaTocada && (fechaIncompleta || (fechaCompleta && !fechaValida))"
            [class.border-amber-500]="fechaIncompleta && !fechaNacimiento.dia">
            <option value="">--</option>
            @for (dia of dias; track dia) {
              <option [value]="dia">{{ dia }}</option>
            }
          </select>
        </div>

        <!-- Mes -->
        <div class="flex flex-col flex-1 sm:flex-initial">
          <label for="mes" class="text-xs sm:text-sm text-gray-600 mb-1 sm:mb-1.5">Mes</label>
          <select id="mes" name="mes" [(ngModel)]="fechaNacimiento.mes"
            (change)="actualizarDias(); marcarFechaTocada()"
            (blur)="marcarFechaTocada()"
            class="select select-sm sm:select-md w-full sm:w-32 md:w-36 border-gray-200 bg-white rounded-xl
            focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"
            [class.border-red-500]="fechaTocada && (fechaIncompleta || (fechaCompleta && !fechaValida))"
            [class.border-amber-500]="fechaIncompleta && !fechaNacimiento.mes">
            <option value="">--</option>
            @for (mes of meses; track mes.valor) {
              <option [value]="mes.valor">{{ mes.nombre }}</option>
            }
          </select>
        </div>

        <!-- Año -->
        <div class="flex flex-col flex-1 sm:flex-initial">
          <label for="anio" class="text-xs sm:text-sm text-gray-600 mb-1 sm:mb-1.5">Año</label>
          <select id="anio" name="anio" [(ngModel)]="fechaNacimiento.anio"
            (change)="actualizarDias(); marcarFechaTocada()"
            (blur)="marcarFechaTocada()"
            class="select select-sm sm:select-md w-full sm:w-24 md:w-28 border-gray-200 bg-white rounded-xl
            focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"
            [class.border-red-500]="fechaTocada && (fechaIncompleta || (fechaCompleta && !fechaValida))"
            [class.border-amber-500]="fechaIncompleta && !fechaNacimiento.anio">
            <option value="">--</option>
            @for (anio of anios; track anio) {
              <option [value]="anio">{{ anio }}</option>
            }
          </select>
        </div>
      </div>
      <!-- Mensajes de información/error -->
      <div class="min-h-5 mt-2 text-center">
        @if (fechaCompleta && fechaValida && edadCalculada !== null) {
          <p class="text-xs sm:text-sm text-green-600">
            <span class="icon-[heroicons-outline--check-circle] inline-block align-middle mr-1"></span>
            Tendrás {{ edadCalculada }} años
          </p>
        }
        @if (fechaTocada && fechaIncompleta) {
          <p class="text-xs sm:text-sm text-amber-600">
            <span class="icon-[heroicons-outline--exclamation-triangle] inline-block align-middle mr-1"></span>
            Debes completar todos los campos de fecha
          </p>
        }
        @if (fechaTocada && fechaCompleta && !fechaValida) {
          <p class="text-xs sm:text-sm text-red-500">
            <span class="icon-[heroicons-outline--exclamation-circle] inline-block align-middle mr-1"></span>
            Debes tener al menos {{ EDAD_MINIMA }} años
          </p>
        }
      </div>
      <!-- Botón para limpiar fecha -->
      @if (fechaIniciada) {
        <div class="mt-3 text-center">
          <button
            type="button"
            (click)="limpiarFecha()"
            class="text-xs sm:text-sm text-gray-500 hover:text-red-500 transition-colors underline"
          >
            <span class="icon-[heroicons-outline--x-mark] inline-block align-middle mr-1"></span>
            Limpiar fecha
          </button>
        </div>
      }
    </article>

    <!-- Género -->
    <article class="bg-gray-50 rounded-xl p-4 sm:p-6">
      <p class="text-sm sm:text-base font-medium text-gray-700 mb-4 flex items-center gap-2">
        <span class="icon-[heroicons-outline--user] text-lg sm:text-xl text-[#034D82]"></span>
        Género con el que te identificas
      </p>
      <div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-6 md:gap-8">
        <label class="flex cursor-pointer items-center gap-2 sm:gap-3 group">
          <input
            type="radio"
            name="genero"
            class="radio radio-sm sm:radio-md radio-primary"
            [(ngModel)]="genero"
            value="femenino"
            (change)="marcarGeneroTocado()"
          />
          <span class="text-sm sm:text-base text-gray-700 group-hover:text-gray-900 transition-colors">Femenino</span>
        </label>
        <label class="flex cursor-pointer items-center gap-2 sm:gap-3 group">
          <input
            type="radio"
            name="genero"
            class="radio radio-sm sm:radio-md radio-primary"
            [(ngModel)]="genero"
            value="masculino"
            (change)="marcarGeneroTocado()"
          />
          <span class="text-sm sm:text-base text-gray-700 group-hover:text-gray-900 transition-colors">Masculino</span>
        </label>
        <label class="flex cursor-pointer items-center gap-2 sm:gap-3 group">
          <input
            type="radio"
            name="genero"
            class="radio radio-sm sm:radio-md radio-primary"
            [(ngModel)]="genero"
            value="otro"
            (change)="marcarGeneroTocado()"
          />
          <span class="text-sm sm:text-base text-gray-700 group-hover:text-gray-900 transition-colors">Otro</span>
        </label>
      </div>
      <!-- Mensaje de confirmación -->
      <div class="min-h-5 mt-2 text-center">
        @if (genero) {
          <p class="text-xs sm:text-sm text-green-600">
            <span class="icon-[heroicons-outline--check-circle] inline-block align-middle mr-1"></span>
            Género seleccionado
          </p>
        }
      </div>
      <!-- Botón para limpiar género -->
      @if (genero) {
        <div class="mt-3 text-center">
          <button
            type="button"
            (click)="limpiarGenero()"
            class="text-xs sm:text-sm text-gray-500 hover:text-red-500 transition-colors underline"
          >
            <span class="icon-[heroicons-outline--x-mark] inline-block align-middle mr-1"></span>
            Limpiar género
          </button>
        </div>
      }
    </article>
  </form>

  <!-- Botones de acción -->
  <div class="relative z-10 flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 mt-4 sm:mt-6">
    <button
      type="button"
      (click)="guardarPerfil()"
      class="btn btn-sm sm:btn-md bg-blue-600 border-blue-600 text-white font-semibold rounded-xl
      shadow-lg shadow-blue-600/25 hover:bg-blue-700 hover:border-blue-700 hover:shadow-blue-700/30
      transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed
      w-full sm:w-auto sm:min-w-[180px] md:min-w-[200px] order-1 sm:order-2"
      [disabled]="isLoading || fechaIncompleta || (fechaCompleta && !fechaValida)"
    >
      @if (isLoading) {
      <span class="loading loading-spinner loading-xs sm:loading-sm"></span>
      <span class="text-xs sm:text-sm">Guardando...</span>
      } @else {
      <span class="icon-[heroicons-outline--check] text-base sm:text-lg"></span>
      <span class="text-xs sm:text-sm">Guardar y Finalizar</span>
      }
    </button>
    <button
      type="button"
      (click)="omitirPaso()"
      class="btn btn-sm sm:btn-md border-2 border-gray-300 bg-transparent text-gray-700 font-medium rounded-xl
      hover:bg-gray-100 hover:border-gray-400 transition-all duration-200 disabled:opacity-70
      w-full sm:w-auto sm:min-w-[160px] md:min-w-[180px] order-2 sm:order-1"
      [disabled]="isLoading"
    >
      <span class="text-xs sm:text-sm">Omitir por ahora</span>
      <span class="icon-[heroicons-outline--arrow-right] text-base sm:text-lg"></span>
    </button>
  </div>
</div>
