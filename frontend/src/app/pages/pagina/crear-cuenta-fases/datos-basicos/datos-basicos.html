<div class="relative flex flex-col gap-4 sm:gap-5 w-full h-full bg-white rounded-2xl p-5 sm:p-8 md:p-10 lg:p-12 shadow-xl border border-[#e8f4fc] overflow-hidden">
  <!-- Decoraciones de fondo -->
  <div class="absolute top-0 right-0 w-24 h-24 sm:w-32 sm:h-32 bg-linear-to-bl from-[#1788EF]/10 to-transparent rounded-bl-full"></div>
  <div class="absolute bottom-0 left-0 w-20 h-20 sm:w-28 sm:h-28 bg-linear-to-tr from-[#00A448]/10 to-transparent rounded-tr-full"></div>

  <!-- Header del paso -->
  <div class="relative z-10 flex items-center gap-3">
    <span class="flex h-8 w-8 sm:h-9 sm:w-9 items-center justify-center rounded-full bg-linear-to-br from-[#034D82] to-[#01162E] text-sm sm:text-base font-bold text-white shadow-md">1</span>
    <div>
      <p class="text-base sm:text-lg font-semibold text-gray-800">Datos Básicos</p>
      <p class="text-xs sm:text-sm text-gray-500">*Todos los campos son obligatorios</p>
    </div>
  </div>

  <!-- Mensaje de error -->
  @if (errorMessage) {
  <div class="relative z-10 rounded-xl border border-red-200 bg-red-50 p-3 sm:p-4">
    <div class="flex items-center gap-3">
      <span class="icon-[hugeicons--alert-circle] text-lg sm:text-xl text-red-500 shrink-0"></span>
      <p class="text-xs sm:text-sm text-red-700 font-medium">{{ errorMessage }}</p>
    </div>
  </div>
  }

  <form [formGroup]="formCrearCuenta" (ngSubmit)="validarCuenta()" class="relative z-10 flex flex-col gap-4 sm:gap-5">
    <!-- Nombre y Apellido -->
    <div class="flex flex-col sm:flex-row gap-4 sm:gap-5">
      <!-- Nombre -->
      <div class="flex-1 space-y-1">
        <label class="floating-label block">
          <span class="text-xs sm:text-sm font-medium text-gray-700">Nombre</span>
          <div class="mt-1 relative">
            <input type="text" formControlName="nombre" placeholder="Ingresa tu nombre"
              [class.border-red-500]="f['nombre'].invalid && f['nombre'].touched"
              class="input input-sm sm:input-md w-full border-gray-200 bg-gray-50/50 text-gray-800 placeholder-gray-400 pr-10 rounded-xl
              transition-all duration-200 focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none" />
            <span class="icon-[material-symbols-light--id-card-rounded] absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg sm:text-xl pointer-events-none"></span>
          </div>
        </label>
        <div class="min-h-4">
          <small class="block text-[10px] sm:text-xs text-red-500 font-medium"
            *ngIf="f['nombre'].invalid && f['nombre'].touched">
            <span *ngIf="f['nombre'].hasError('required')">El nombre es requerido.</span>
            <span *ngIf="f['nombre'].hasError('minlength')">Mínimo 2 caracteres.</span>
            <span *ngIf="f['nombre'].hasError('pattern')">Solo se permiten letras.</span>
          </small>
        </div>
      </div>

      <!-- Apellido -->
      <div class="flex-1 space-y-1">
        <label class="floating-label block">
          <span class="text-xs sm:text-sm font-medium text-gray-700">Apellido</span>
          <div class="mt-1 relative">
            <input type="text" formControlName="apellido" placeholder="Ingresa tu apellido"
              [class.border-red-500]="f['apellido'].invalid && f['apellido'].touched"
              class="input input-sm sm:input-md w-full border-gray-200 bg-gray-50/50 text-gray-800 placeholder-gray-400 pr-10 rounded-xl
              transition-all duration-200 focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none" />
            <span class="icon-[material-symbols-light--id-card-rounded] absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg sm:text-xl pointer-events-none"></span>
          </div>
        </label>
        <div class="min-h-4">
          <small class="block text-[10px] sm:text-xs text-red-500 font-medium"
            *ngIf="f['apellido'].invalid && f['apellido'].touched">
            <span *ngIf="f['apellido'].hasError('required')">El apellido es requerido.</span>
            <span *ngIf="f['apellido'].hasError('minlength')">Mínimo 2 caracteres.</span>
            <span *ngIf="f['apellido'].hasError('pattern')">Solo se permiten letras.</span>
          </small>
        </div>
      </div>
    </div>

    <!-- Correo -->
    <div class="space-y-1">
      <label class="floating-label block">
        <span class="text-xs sm:text-sm font-medium text-gray-700">Correo electrónico</span>
        <div class="mt-1 relative">
          <input type="email" formControlName="correo" placeholder="mail@site.com"
            [class.border-red-500]="f['correo'].invalid && f['correo'].touched"
            class="input input-sm sm:input-md w-full border-gray-200 bg-gray-50/50 text-gray-800 placeholder-gray-400 pr-10 rounded-xl
            transition-all duration-200 focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none" />
          <span class="icon-[material-symbols-light--mail-rounded] absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-lg sm:text-xl pointer-events-none"></span>
        </div>
      </label>
      <div class="min-h-4">
        <small class="block text-[10px] sm:text-xs text-red-500 font-medium"
          *ngIf="f['correo'].invalid && f['correo'].touched">
          <span *ngIf="f['correo'].hasError('required')">El correo es requerido.</span>
          <span *ngIf="f['correo'].hasError('email')">Ingresa un correo válido.</span>
        </small>
      </div>
    </div>

    <!-- Divider -->
    <div class="divider text-gray-400 text-xs my-1 sm:my-2">Contraseña</div>

    <!-- Contraseñas -->
    <div class="flex flex-col sm:flex-row gap-4 sm:gap-5">
      <!-- Contraseña -->
      <div class="flex-1 space-y-1">
        <label class="floating-label block">
          <span class="text-xs sm:text-sm font-medium text-gray-700">Contraseña</span>
          <div class="mt-1 flex items-center gap-2">
            <input [type]="mostrarContrasena ? 'text' : 'password'" formControlName="contrasena"
              (input)="verificarIndicaciones()" placeholder="••••••••"
              [class.border-red-500]="f['contrasena'].invalid && f['contrasena'].touched"
              class="input input-sm sm:input-md flex-1 border-gray-200 bg-gray-50/50 text-gray-800 placeholder-gray-400 rounded-xl
              transition-all duration-200 focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none" />
            <button type="button" (mousedown)="$event.preventDefault()" (click)="toggleContrasena()"
              class="btn btn-square btn-sm sm:btn-md border-gray-200 bg-gray-50/50 text-gray-500 rounded-xl
              transition-all duration-200 hover:bg-blue-50 hover:border-blue-300 hover:text-blue-600">
              <span *ngIf="!mostrarContrasena" class="icon-[fluent--eye-16-regular] text-base sm:text-lg"></span>
              <span *ngIf="mostrarContrasena" class="icon-[fluent--eye-off-16-regular] text-base sm:text-lg"></span>
            </button>
          </div>
        </label>
        <div class="min-h-4">
          <small class="block text-[10px] sm:text-xs text-red-500 font-medium"
            *ngIf="f['contrasena'].invalid && f['contrasena'].touched">
            Faltan requerimientos para la contraseña.
          </small>
        </div>
      </div>

      <!-- Confirmar Contraseña -->
      <div class="flex-1 space-y-1">
        <label class="floating-label block">
          <span class="text-xs sm:text-sm font-medium text-gray-700">Confirmar contraseña</span>
          <div class="mt-1 flex items-center gap-2">
            <input [type]="mostrarConfirmarContrasena ? 'text' : 'password'" formControlName="confirmarContrasena"
              placeholder="••••••••"
              [class.border-red-500]="(f['confirmarContrasena'].touched && formCrearCuenta.errors?.['noCoinciden'])"
              class="input input-sm sm:input-md flex-1 border-gray-200 bg-gray-50/50 text-gray-800 placeholder-gray-400 rounded-xl
              transition-all duration-200 focus:bg-white focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none" />
            <button type="button" (mousedown)="$event.preventDefault()" (click)="toggleConfirmarContrasena()"
              class="btn btn-square btn-sm sm:btn-md border-gray-200 bg-gray-50/50 text-gray-500 rounded-xl
              transition-all duration-200 hover:bg-blue-50 hover:border-blue-300 hover:text-blue-600">
              <span *ngIf="!mostrarConfirmarContrasena" class="icon-[fluent--eye-16-regular] text-base sm:text-lg"></span>
              <span *ngIf="mostrarConfirmarContrasena" class="icon-[fluent--eye-off-16-regular] text-base sm:text-lg"></span>
            </button>
          </div>
        </label>
        <div class="min-h-4">
          <small class="block text-[10px] sm:text-xs text-red-500 font-medium"
            *ngIf="formCrearCuenta.errors?.['noCoinciden'] && f['confirmarContrasena'].touched">
            Las contraseñas no coinciden.
          </small>
        </div>
      </div>
    </div>

    <!-- Indicaciones dinámicas -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 text-xs sm:text-sm bg-gray-50 rounded-xl p-3 sm:p-4">
      <ul class="space-y-1.5 sm:space-y-2">
        <li class="flex items-center gap-2 transition-colors duration-200" [class.text-green-600]="indicaciones.longitud"
          [class.text-gray-500]="!indicaciones.longitud">
          <span class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-colors duration-200" [class.bg-green-500]="indicaciones.longitud"
            [class.bg-gray-300]="!indicaciones.longitud"></span>
          Usa 8 o más caracteres
        </li>
        <li class="flex items-center gap-2 transition-colors duration-200" [class.text-green-600]="indicaciones.numero"
          [class.text-gray-500]="!indicaciones.numero">
          <span class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-colors duration-200" [class.bg-green-500]="indicaciones.numero"
            [class.bg-gray-300]="!indicaciones.numero"></span>
          Incluye al menos un número
        </li>
      </ul>
      <ul class="space-y-1.5 sm:space-y-2">
        <li class="flex items-center gap-2 transition-colors duration-200" [class.text-green-600]="indicaciones.mayuscula"
          [class.text-gray-500]="!indicaciones.mayuscula">
          <span class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-colors duration-200" [class.bg-green-500]="indicaciones.mayuscula"
            [class.bg-gray-300]="!indicaciones.mayuscula"></span>
          Mayúsculas y minúsculas
        </li>
        <li class="flex items-center gap-2 transition-colors duration-200" [class.text-green-600]="indicaciones.simbolo"
          [class.text-gray-500]="!indicaciones.simbolo">
          <span class="w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-colors duration-200" [class.bg-green-500]="indicaciones.simbolo"
            [class.bg-gray-300]="!indicaciones.simbolo"></span>
          Incluye un símbolo (!@#$)
        </li>
      </ul>
    </div>

    <!-- Términos -->
    <div class="space-y-1">
      <label class="flex cursor-pointer items-center gap-2 sm:gap-3 group select-none">
        <input type="checkbox" formControlName="terminos" class="checkbox checkbox-xs sm:checkbox-sm checkbox-primary rounded-md" />
        <span class="text-xs sm:text-sm text-gray-600 group-hover:text-gray-800 transition-colors leading-tight">
          Acepto los <a (click)="navegarATerminos()" class="text-blue-600 font-medium hover:underline cursor-pointer">términos y condiciones</a> y
          <a (click)="navegarAPoliticas()" class="text-blue-600 font-medium hover:underline cursor-pointer">políticas de privacidad</a>
        </span>
      </label>
      <div class="min-h-4 pl-5 sm:pl-7">
        <small class="block text-[10px] sm:text-xs text-red-500 font-medium"
          *ngIf="f['terminos'].invalid && f['terminos'].touched">
          Debe aceptar los términos y condiciones.
        </small>
      </div>
    </div>

    <!-- reCAPTCHA -->
    <div class="flex flex-col items-center w-full overflow-hidden">
      <div class="transform scale-[0.65] xs:scale-[0.75] sm:scale-[0.85] md:scale-100 origin-center transition-transform duration-200">
        <re-captcha [siteKey]="siteKey" formControlName="recaptcha" (resolved)="onRecaptchaResolved($event)"></re-captcha>
      </div>
      <div class="min-h-4 mt-1">
        <small class="block text-[10px] sm:text-xs text-red-500 font-medium text-center"
          *ngIf="f['recaptcha']?.invalid && f['recaptcha']?.touched">
          Por favor, complete el captcha.
        </small>
      </div>
    </div>

    <!-- Botón Submit -->
    <button type="submit"
      class="btn btn-block btn-sm sm:btn-md bg-blue-600 border-blue-600 text-white font-semibold rounded-xl
      shadow-lg shadow-blue-600/25 hover:bg-blue-700 hover:border-blue-700 hover:shadow-blue-700/30
      transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed"
      [disabled]="isLoading || cooldownSeconds > 0">
      @if (isLoading) {
      <span class="loading loading-spinner loading-xs sm:loading-sm"></span>
      <span class="text-xs sm:text-sm">Enviando código...</span>
      } @else if (cooldownSeconds > 0) {
      <span class="icon-[heroicons-outline--clock] text-base sm:text-lg"></span>
      <span class="text-xs sm:text-sm">Espera {{ cooldownSeconds }}s</span>
      } @else {
      <span class="text-xs sm:text-sm">Validar cuenta</span>
      <span class="icon-[heroicons-outline--arrow-right] text-base sm:text-lg"></span>
      }
    </button>
  </form>
</div>
