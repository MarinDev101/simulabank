<div class="h-full w-full rounded-xl bg-white p-8 dark:bg-gray-800">
  <section class="container mx-auto">
    <!-- Encabezado -->
    <div class="sm:flex sm:items-center sm:justify-between">
      <div>
        <div class="flex items-center gap-x-3">
          <h2 class="text-lg font-medium text-gray-800 dark:text-white">Simulaciones</h2>
          <span
            class="rounded-full bg-blue-100 px-3 py-1 text-xs text-blue-600 dark:bg-gray-800 dark:text-blue-400"
          >
            {{ evidenciasFiltradas.length }} Archivos
          </span>
        </div>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-300">
          Aquí encontrarás todos los registros de las simulaciones que has realizado en SimulaBank
        </p>
      </div>
    </div>

    <!-- Filtros -->
    <div class="mt-6 md:flex md:items-center md:justify-between">
      <!-- Filtros de estado -->
      <div
        class="inline-flex divide-x overflow-hidden rounded-lg border bg-white rtl:flex-row-reverse dark:divide-gray-700 dark:border-gray-700 dark:bg-gray-900"
      >
        <button
          (click)="cambiarFiltroEstado('visibles')"
          [class.bg-gray-100]="filtroEstado === 'visibles'"
          [class.dark:bg-gray-800]="filtroEstado === 'visibles'"
          class="px-5 py-2 text-xs font-medium text-gray-600 transition-colors duration-200 hover:bg-gray-100 sm:text-sm dark:text-gray-300 dark:hover:bg-gray-800"
        >
          Visibles
        </button>
        <button
          (click)="cambiarFiltroEstado('archivadas')"
          [class.bg-gray-100]="filtroEstado === 'archivadas'"
          [class.dark:bg-gray-800]="filtroEstado === 'archivadas'"
          class="px-5 py-2 text-xs font-medium text-gray-600 transition-colors duration-200 hover:bg-gray-100 sm:text-sm dark:text-gray-300 dark:hover:bg-gray-800"
        >
          Archivadas
        </button>
        <button
          (click)="cambiarFiltroEstado('todas')"
          [class.bg-gray-100]="filtroEstado === 'todas'"
          [class.dark:bg-gray-800]="filtroEstado === 'todas'"
          class="px-5 py-2 text-xs font-medium text-gray-600 transition-colors duration-200 hover:bg-gray-100 sm:text-sm dark:text-gray-300 dark:hover:bg-gray-800"
        >
          Ver todo
        </button>
      </div>

      <!-- Filtros de fecha -->
      <div class="relative mt-4 flex items-center gap-3 md:mt-0">
        <label class="flex flex-col">
          <span class="text-sm text-gray-700 dark:text-gray-200">Desde</span>
          <input
            type="datetime-local"
            [value]="filtroFechaDesde"
            (change)="onFechaDesdeChange($event)"
            class="rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 placeholder-gray-400 focus:border-blue-500 focus:ring-0 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-500"
          />
        </label>
        <label class="flex flex-col">
          <span class="text-sm text-gray-700 dark:text-gray-200">Hasta</span>
          <input
            type="datetime-local"
            [value]="filtroFechaHasta"
            (change)="onFechaHastaChange($event)"
            class="rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 placeholder-gray-400 focus:border-blue-500 focus:ring-0 focus:outline-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 dark:placeholder-gray-500"
          />
        </label>
      </div>
    </div>

    <!-- Estados de carga -->
    <div *ngIf="cargando" class="mt-6 flex justify-center">
      <div class="h-12 w-12 animate-spin rounded-full border-b-2 border-blue-600"></div>
    </div>

    <div *ngIf="error" class="mt-6 rounded-lg bg-red-50 p-4 dark:bg-red-900/20">
      <p class="text-sm text-red-600 dark:text-red-400">{{ error }}</p>
    </div>

    <!-- Tabla de evidencias -->
    <div *ngIf="!cargando && !error" class="mt-6 flex flex-col">
      <div class="-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
        <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
          <div class="overflow-hidden border border-gray-200 md:rounded-lg dark:border-gray-700">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
              <thead class="bg-gray-50 dark:bg-gray-800">
                <tr>
                  <th
                    scope="col"
                    class="px-4 py-3.5 text-left text-sm font-normal text-gray-500 rtl:text-right dark:text-gray-400"
                  >
                    Archivos
                  </th>
                  <th
                    scope="col"
                    class="px-4 py-3.5 text-left text-sm font-normal text-gray-500 rtl:text-right dark:text-gray-400"
                  >
                    Producto
                  </th>
                  <th
                    scope="col"
                    class="px-4 py-3.5 text-left text-sm font-normal text-gray-500 rtl:text-right dark:text-gray-400"
                  >
                    Modo
                  </th>
                  <th
                    scope="col"
                    class="px-4 py-3.5 text-left text-sm font-normal text-gray-500 rtl:text-right dark:text-gray-400"
                  >
                    Tiempo
                  </th>
                  <th
                    scope="col"
                    class="px-4 py-3.5 text-left text-sm font-normal text-gray-500 rtl:text-right dark:text-gray-400"
                  >
                    Fecha de subida
                  </th>
                  <th
                    scope="col"
                    class="px-4 py-3.5 text-left text-sm font-normal text-gray-500 rtl:text-right dark:text-gray-400"
                  >
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody
                class="divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"
              >
                <!-- Mensaje si no hay evidencias -->
                <tr *ngIf="evidenciasPaginadas.length === 0">
                  <td
                    colspan="6"
                    class="px-4 py-8 text-center text-sm text-gray-500 dark:text-gray-400"
                  >
                    No se encontraron evidencias con los filtros seleccionados
                  </td>
                </tr>

                <!-- Filas de evidencias -->
                <tr *ngFor="let evidencia of evidenciasPaginadas">
                  <td class="px-4 py-4 text-sm font-medium whitespace-nowrap text-gray-700">
                    <div class="inline-flex items-center gap-x-3">
                      <div class="flex items-center gap-x-2">
                        <div
                          class="flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 text-blue-500 dark:bg-gray-800"
                        >
                          <span class="icon-[hugeicons--pdf-01] size-6"></span>
                        </div>

                        <div>
                          <h2 class="font-normal text-gray-800 dark:text-white">
                            {{ evidencia.nombreSugerido }}
                          </h2>
                          <p class="text-xs font-normal text-gray-500 dark:text-gray-400">
                            {{ formatearPeso(evidencia.peso_pdf_kb) }}
                          </p>
                        </div>
                      </div>
                    </div>
                  </td>
                  <td class="px-4 py-4 text-sm whitespace-nowrap text-gray-700 dark:text-gray-200">
                    {{ evidencia.producto_nombre }}
                  </td>
                  <td class="px-4 py-4 text-sm whitespace-nowrap">
                    <span
                      [ngClass]="getColorModo(evidencia.modo)"
                      class="rounded-full px-3 py-1 text-xs font-medium"
                    >
                      {{ evidencia.modo | titlecase }}
                    </span>
                  </td>
                  <td class="px-4 py-4 text-sm whitespace-nowrap text-gray-500 dark:text-gray-300">
                    {{ formatearDuracion(evidencia.tiempo_duracion_segundos) }}
                  </td>
                  <td class="px-4 py-4 text-sm whitespace-nowrap text-gray-500 dark:text-gray-300">
                    {{ formatearFecha(evidencia.fecha_agregado) }}
                  </td>
                  <td class="px-4 py-4 text-sm whitespace-nowrap">
                    <div class="flex items-center gap-x-2">
                      <!-- Visualizar -->
                      <button
                        (click)="visualizarEvidencia(evidencia)"
                        class="flex items-center rounded-full bg-blue-100/60 px-3 py-1 text-xs text-blue-500 transition-colors hover:bg-blue-200 dark:bg-gray-800 dark:hover:bg-gray-700"
                        title="Visualizar"
                      >
                        <span class="icon-[heroicons-outline--eye] h-5 w-5"></span>
                      </button>

                      <!-- Descargar (solo si está visible) -->
                      <button
                        *ngIf="evidencia.estado === 'visible'"
                        (click)="descargarEvidencia(evidencia)"
                        class="flex items-center rounded-full bg-green-100/60 px-3 py-1 text-xs text-green-500 transition-colors hover:bg-green-200 dark:bg-gray-800 dark:hover:bg-gray-700"
                        title="Descargar"
                      >
                        <span class="icon-[heroicons-outline--download] h-5 w-5"></span>
                      </button>

                      <!-- Archivar/Desarchivar -->
                      <button
                        (click)="toggleArchivar(evidencia)"
                        [ngClass]="{
                          'bg-gray-100/60 text-gray-500 hover:bg-gray-200': evidencia.estado === 'visible',
                          'bg-orange-100/60 text-orange-500 hover:bg-orange-200': evidencia.estado !== 'visible'
                        }"
                        class="flex items-center rounded-full px-3 py-1 text-xs transition-colors dark:bg-gray-800 dark:hover:bg-gray-700"
                        [title]="evidencia.estado === 'visible' ? 'Archivar' : 'Desarchivar'"
                      >
                        <span
                          [ngClass]="{
                            'icon-[fluent--archive-16-regular]': evidencia.estado === 'visible',
                            'icon-[heroicons-outline--archive-box-arrow-down]': evidencia.estado !== 'visible'
                          }"
                          class="h-5 w-5"
                        ></span>
                      </button>

                      <!-- Eliminar (solo si está archivada) -->
                      <button
                        *ngIf="evidencia.estado === 'archivada'"
                        (click)="eliminarEvidencia(evidencia)"
                        class="flex items-center rounded-full bg-red-100/60 px-3 py-1 text-xs text-red-500 transition-colors hover:bg-red-200 dark:bg-gray-800 dark:hover:bg-gray-700"
                        title="Eliminar"
                      >
                        <span class="icon-[heroicons-outline--trash] h-5 w-5"></span>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Paginación -->
    <div
      *ngIf="!cargando && evidenciasFiltradas.length > 0"
      class="mt-6 sm:flex sm:items-center sm:justify-between"
    >
      <div class="flex items-center gap-3 text-sm text-gray-600 dark:text-gray-300">
        <label for="itemsPerPage" class="font-medium text-gray-700 dark:text-gray-100">
          Archivos por página
        </label>

        <div class="dropdown dropdown-right dropdown-center" [class.dropdown-open]="isOpen">
          <div
            tabindex="0"
            (click)="toggleDropdown()"
            class="flex h-10 min-w-20 cursor-pointer items-center justify-between rounded-lg border border-gray-300 bg-white px-3 text-gray-700 select-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100"
          >
            <span>{{ selectedValue }}</span>
            <span class="icon-[heroicons--chevron-right]"></span>
          </div>

          <ul
            tabindex="0"
            class="dropdown-content menu z-[1] w-32 rounded-lg bg-base-100 p-2 shadow dark:bg-gray-800"
          >
            <li><a (click)="selectValue(5, $event)">5</a></li>
            <li><a (click)="selectValue(10, $event)">10</a></li>
            <li><a (click)="selectValue(15, $event)">15</a></li>
            <li><a (click)="selectValue(20, $event)">20</a></li>
          </ul>
        </div>
      </div>

      <div class="mt-4 flex items-center gap-x-4 sm:mt-0">
        <div class="text-sm text-gray-500 dark:text-gray-400">
          Página
          <span class="font-medium text-gray-700 dark:text-gray-100">
            {{ paginaActual }} de {{ totalPaginas || 1 }}
          </span>
        </div>
        <button
          (click)="paginaAnterior()"
          [disabled]="paginaActual === 1"
          [class.opacity-50]="paginaActual === 1"
          [class.cursor-not-allowed]="paginaActual === 1"
          class="flex w-1/2 items-center justify-center gap-x-2 rounded-md border bg-white px-5 py-2 text-sm text-gray-700 capitalize transition-colors duration-200 hover:bg-gray-100 disabled:hover:bg-white sm:w-auto dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200 dark:hover:bg-gray-800 dark:disabled:hover:bg-gray-900"
        >
          <span class="icon-[heroicons--chevron-left] h-5 w-5 rtl:-scale-x-100"></span>
          <span>Anterior</span>
        </button>

        <button
          (click)="paginaSiguiente()"
          [disabled]="paginaActual === totalPaginas"
          [class.opacity-50]="paginaActual === totalPaginas"
          [class.cursor-not-allowed]="paginaActual === totalPaginas"
          class="flex w-1/2 items-center justify-center gap-x-2 rounded-md border bg-white px-5 py-2 text-sm text-gray-700 capitalize transition-colors duration-200 hover:bg-gray-100 disabled:hover:bg-white sm:w-auto dark:border-gray-700 dark:bg-gray-900 dark:text-gray-200 dark:hover:bg-gray-800 dark:disabled:hover:bg-gray-900"
        >
          <span>Siguiente</span>
          <span class="icon-[heroicons--chevron-right] h-5 w-5 rtl:-scale-x-100"></span>
        </button>
      </div>
    </div>
  </section>
</div>

<!-- Modal de visualización de PDF -->
<div
  *ngIf="mostrarModalPdf"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm transition-all duration-300 dark:bg-black/75"
  (click)="cerrarModalPdf()"
>
  <div
    class="flex h-[90vh] w-full max-w-6xl flex-col overflow-hidden rounded-xl bg-white shadow-2xl ring-1 ring-black/5 transition-all duration-300 dark:bg-gray-800 dark:ring-white/10"
    (click)="$event.stopPropagation()"
  >
    <!-- Header del modal -->
    <div
      class="flex items-center justify-between border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white px-6 py-4 dark:border-gray-700 dark:from-gray-800 dark:to-gray-800"
    >
      <div class="flex items-center gap-3">
        <div
          class="flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100 dark:bg-blue-900/30"
        >
          <span
            class="icon-[heroicons-outline--document-text] h-5 w-5 text-blue-600 dark:text-blue-400"
          ></span>
        </div>
        <h3 class="truncate text-lg font-semibold text-gray-900 dark:text-gray-100">
          {{ nombreArchivoPdf }}
        </h3>
      </div>
      <button
        (click)="cerrarModalPdf()"
        class="group rounded-lg p-2 transition-all duration-200 hover:bg-gray-200 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none dark:hover:bg-gray-700 dark:focus:ring-offset-gray-800"
        aria-label="Cerrar"
      >
        <span
          class="icon-[heroicons-outline--x-mark] h-5 w-5 text-gray-500 transition-colors group-hover:text-gray-700 dark:text-gray-400 dark:group-hover:text-gray-200"
        ></span>
      </button>
    </div>

    <!-- Contenido del modal -->
    <div class="flex-1 overflow-hidden bg-gray-50 dark:bg-gray-900">
      <!-- Loading state -->
      <div *ngIf="cargandoPdf" class="flex h-full flex-col items-center justify-center gap-4">
        <div class="relative">
          <div
            class="h-16 w-16 animate-spin rounded-full border-4 border-gray-200 border-t-blue-600 dark:border-gray-700 dark:border-t-blue-500"
          ></div>
          <div class="absolute inset-0 flex items-center justify-center">
            <span
              class="icon-[heroicons-outline--document] h-6 w-6 text-blue-600 dark:text-blue-500"
            ></span>
          </div>
        </div>
        <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Cargando documento...</p>
      </div>

      <!-- Visor de PDF usando ng2-pdfjs-viewer -->
      <div *ngIf="!cargandoPdf && pdfSrc" class="h-full">
        <ng2-pdfjs-viewer
          [pdfSrc]="pdfSrc"
          [viewerFolder]="'assets/pdfjs'"
          [urlValidation]="false"
          [download]="false"
          [print]="false"
          [openFile]="false"
          [viewBookmark]="false"
          [zoom]="'page-width'"
          class="h-full overflow-hidden rounded-lg shadow-inner ring-1 ring-black/5 dark:ring-white/10"
        ></ng2-pdfjs-viewer>
      </div>
    </div>

    <!-- Footer con botones -->
    <div
      class="flex items-center justify-between border-t border-gray-200 bg-gradient-to-r from-gray-50 to-white px-6 py-4 dark:border-gray-700 dark:from-gray-800 dark:to-gray-800"
    >
      <p class="text-sm text-gray-500 dark:text-gray-400">Documento PDF</p>

      <div class="flex items-center gap-3">
        <button
          *ngIf="evidenciaEnModalEstado === 'visible'"
          (click)="descargarPdfModal()"
          [disabled]="cargandoPdf"
          class="group flex items-center gap-2 rounded-lg bg-blue-600/60 px-4 py-2.5 text-sm font-medium text-blue-700 transition-all duration-200 hover:bg-blue-700/70 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-offset-gray-800"
          title="Descargar"
        >
          <span
            class="icon-[heroicons-outline--arrow-down-tray] h-5 w-5 transition-transform group-hover:scale-110"
          ></span>
          <span>Descargar</span>
        </button>

        <button
          (click)="cerrarModalPdf()"
          class="group flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 shadow-sm transition-all duration-200 hover:bg-gray-50 focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 dark:focus:ring-offset-gray-800"
        >
          <span class="icon-[heroicons-outline--x-mark] h-5 w-5"></span>
          <span>Cerrar</span>
        </button>
      </div>
    </div>
  </div>
</div>
